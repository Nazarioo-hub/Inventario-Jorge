<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <title>Cat√°logo de Fotos e Exposi√ß√µes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        body { font-family: Arial,sans-serif; background: #222; color: #eee; margin:0; }
        header { background: #333; padding: 1em; text-align: center; font-size: 1.6em; }
        main { display: flex; flex-wrap: wrap; margin:0; }
        section { flex: 1; min-width:300px; padding:1em; box-sizing: border-box; }
        h2 { margin-top:0; color: #36a; }
        .card { background:#2A2A2A; padding:1em; margin:1em 0; border-radius:8px; }
        table { width:100%; border-collapse: collapse; margin-bottom:1em; }
        th, td { padding:0.5em; border-bottom:1px solid #444; }
        th { color: #ddd; text-align:left; background: #222;}
        img.thumb { width:60px; height:auto; border-radius:4px; }
        .btn { background:#36a; color:#fff; border:none; padding:0.4em 1em; border-radius:5px; cursor:pointer; margin-right: 8px;}
        .btn:active { filter: brightness(0.85);}
        input[type="text"] { background:#333; color:#fff; border:1px solid #555; border-radius:4px; padding:0.4em;}
        .modal { display: none; position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.6);
            align-items: center; justify-content: center; z-index: 1000; }
        .modal.active { display: flex; }
        .modal-content { background: #222; padding: 20px; border-radius: 10px; width: 300px; color: #eee; box-sizing: border-box; }
        .modal-content h3 { margin-top: 0; }
        label.checklist { margin-bottom: 0.5em; display: block; cursor: pointer; }
    </style>
</head>
<body>

<header>Cat√°logo de Fotos e Exposi√ß√µes</header>

<main>
<section style="flex-basis:400px;">
    <h2>Adicionar Foto</h2>
    <div class="card">
        <form id="addForm">
            <label>Nome da foto:<br>
                <input type="text" required id="nomeFoto">
            </label><br><br>
            <label>Imagem da foto (URL ou ficheiro):<br>
                <input type="file" accept="image/*" id="filePhoto"><br>ou<br>
                <input type="text" placeholder="URL da imagem" id="urlPhoto">
            </label><br><br>
            <label><input type="checkbox" id="tamP"> Pequeno</label>
            <label><input type="checkbox" id="tamM"> M√©dio</label>
            <label><input type="checkbox" id="tamG"> Grande</label>
            <br><br>
            <button class="btn" type="submit">Adicionar</button>
        </form>
    </div>
</section>

<section>
    <h2>Fotos em Casa</h2>
    <div class="card">
        <button class="btn" onclick="apagarTodasFotos()">Apagar Todas as Fotos em Casa</button>
        <table id="tableCasa">
            <thead>
                <tr>
                    <th>Foto</th>
                    <th>Nome</th>
                    <th>Tamanho</th>
                    <th>Enviar para Exposi√ß√£o</th>
                    <th>Destino</th>
                    <th>Datas</th>
                    <th>Remover</th>
                    <th>Editar Tamanhos</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</section>
</main>

<!-- Modal para editar tamanhos -->
<div id="modalEditarTamanhos" class="modal">
    <div class="modal-content">
        <h3>Editar Tamanhos da Foto</h3>
        <div id="checkboxesTamanhos"></div>
        <div style="margin-top: 1em;">
            <button class="btn" onclick="fecharModalEditarTamanhos()">Cancelar</button>
            <button class="btn" onclick="salvarTamanhosEditados()">Salvar</button>
        </div>
    </div>
</div>

<script>
const tamanhos = [
    { id: "p", nome: "Pequeno" },
    { id: "m", nome: "M√©dio" },
    { id: "g", nome: "Grande" }
];

let fotos = [];

function salvarLocalStorage() {
    localStorage.setItem("catalogoFotosExpsoicoes", JSON.stringify(fotos));
}

function carregarLocalStorage() {
    const data = localStorage.getItem("catalogoFotosExpsoicoes");
    if (data) {
        fotos = JSON.parse(data);
    } else {
        fotos = [];
    }
}

document.getElementById('addForm').onsubmit = function(e) {
    e.preventDefault();
    let nome = document.getElementById('nomeFoto').value.trim();
    let imageUrl = document.getElementById('urlPhoto').value.trim();
    const fileInput = document.getElementById('filePhoto');
    if(fileInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(ev) {
            inserirFoto(nome, ev.target.result);
        };
        reader.readAsDataURL(fileInput.files[0]);
    } else {
        inserirFoto(nome, imageUrl);
    }
};

function novaFotoObj({nome, imageUrl, tamanhosDisponiveis}) {
    let obj = {
        id: 'f' + Date.now() + Math.floor(Math.random()*9999),
        nome,
        imageUrl,
        tamanhos: {}
    };
    tamanhos.forEach(t => {
        obj.tamanhos[t.id] = {
            disponivel: tamanhosDisponiveis.includes(t.id),
            enviado: false,
            exposicao: "",
            dataInicio: "",
            dataFim: "",
            risked: false
        };
    });
    return obj;
}

function inserirFoto(nome, imageUrl){
    let tam = [];
    if(document.getElementById('tamP').checked) tam.push("p");
    if(document.getElementById('tamM').checked) tam.push("m");
    if(document.getElementById('tamG').checked) tam.push("g");

    if(!nome || !imageUrl || tam.length === 0) {
        alert("Preencha todos os campos (nome, imagem e tamanhos)!");
        return;
    }

    fotos.push(novaFotoObj({nome, imageUrl, tamanhosDisponiveis: tam}));

    document.getElementById('nomeFoto').value = "";
    document.getElementById('urlPhoto').value = "";
    document.getElementById('filePhoto').value = "";
    document.getElementById('tamP').checked = false;
    document.getElementById('tamM').checked = false;
    document.getElementById('tamG').checked = false;

    atualizarUI();
}

function apagarTodasFotos(){
    if(confirm("Tem a certeza que deseja apagar todas as fotos em casa?")){
        fotos = [];
        salvarLocalStorage();
        atualizarUI();
    }
}

function marcarEnviadoGrupo(nomeFoto, valor){
    fotos.forEach(foto => {
        if(foto.nome === nomeFoto){
            tamanhos.forEach(t => {
                if(foto.tamanhos[t.id].disponivel){
                    foto.tamanhos[t.id].enviado = valor;
                    if(!valor){
                        foto.tamanhos[t.id].exposicao = "";
                        foto.tamanhos[t.id].dataInicio = "";
                        foto.tamanhos[t.id].dataFim = "";
                        foto.tamanhos[t.id].risked = false;
                    }
                }
            });
        }
    });
    atualizarUI();
}

function definirExposicaoGrupo(nomeFoto, valor) {
    fotos.forEach(foto => {
        if(foto.nome === nomeFoto){
            tamanhos.forEach(t => {
                if(foto.tamanhos[t.id].disponivel && foto.tamanhos[t.id].enviado){
                    foto.tamanhos[t.id].exposicao = valor;
                }
            });
        }
    });
    atualizarUI();
}

function removerFotoGrupo(nomeFoto) {
    fotos = fotos.filter(foto => foto.nome !== nomeFoto);
    atualizarUI();
}

function atualizarTabelaCasa() {
    const tb = document.querySelector('#tableCasa tbody');
    tb.innerHTML = "";

    const grupos = {};
    fotos.forEach(foto => {
        if(!grupos[foto.nome]){
            grupos[foto.nome] = {
                fotoGeral: foto,
                tamanhos: []
            };
        }
        tamanhos.forEach(t => {
            if(foto.tamanhos[t.id].disponivel){
                grupos[foto.nome].tamanhos.push({
                    id: t.id,
                    nome: t.nome,
                    enviado: foto.tamanhos[t.id].enviado,
                    exposicao: foto.tamanhos[t.id].exposicao
                });
            }
        });
    });

    Object.values(grupos).forEach(grupo => {
        const foto = grupo.fotoGeral;
        const tamanhosDisponiveis = grupo.tamanhos.map(t => t.enviado ? `${t.nome} (em exposi√ß√£o)` : t.nome);

        if(tamanhosDisponiveis.length === 0) return;

        const temEnviado = grupo.tamanhos.some(t => t.enviado);

        let exposicaoValor = "";
        for(let t of grupo.tamanhos){
            if(t.enviado && t.exposicao){
                exposicaoValor = t.exposicao;
                break;
            }
        }

        let tr = document.createElement("tr");
        tr.innerHTML = `
            <td><img class="thumb" src="${foto.imageUrl}"></td>
            <td>${foto.nome}</td>
            <td>${tamanhosDisponiveis.join(", ")}</td>
            <td>
                ${temEnviado
                    ? "Indispon√≠vel (em exposi√ß√£o)"
                    : `<input type="checkbox" onchange="marcarEnviadoGrupo('${foto.nome}', this.checked)">
                       <label>Ir para exposi√ß√£o</label>`
                }
            </td>
            <td>
                <input type="text" placeholder="Nome exposi√ß√£o" value="${exposicaoValor}"
                    ${temEnviado ? "" : "disabled"}
                    onchange="definirExposicaoGrupo('${foto.nome}', this.value)">
            </td>
            <td>---</td>
            <td><button class="btn" onclick="removerFotoGrupo('${foto.nome}')">üóë</button></td>
            <td><button class="btn" onclick="abrirEditorTamanhos('${foto.nome}')">Editar Tamanhos</button></td>
        `;
        tb.appendChild(tr);
    });
}

// Modal editar tamanhos
let fotoEditando = null;

function abrirEditorTamanhos(nomeFoto){
    fotoEditando = fotos.find(foto => foto.nome === nomeFoto);
    if(!fotoEditando) return;

    const container = document.getElementById("checkboxesTamanhos");
    container.innerHTML = "";

    tamanhos.forEach(t => {
        const disponivel = fotoEditando.tamanhos[t.id].disponivel;
        const label = document.createElement("label");
        label.className = "checklist";
        label.innerHTML = `<input type="checkbox" id="tamEdit_${t.id}" ${disponivel ? "checked" : ""}> ${t.nome}`;
        container.appendChild(label);
    });

    document.getElementById("modalEditarTamanhos").classList.add("active");
}

function fecharModalEditarTamanhos(){
    document.getElementById("modalEditarTamanhos").classList.remove("active");
    fotoEditando = null;
}

function salvarTamanhosEditados(){
    if(!fotoEditando) return;

    tamanhos.forEach(t=>{
        const checkbox = document.getElementById(`tamEdit_${t.id}`);
        const marcado = checkbox.checked;
        const tamObj = fotoEditando.tamanhos[t.id];
        if(tamObj.disponivel !== marcado){
            tamObj.disponivel = marcado;
            if(!marcado){
                tamObj.enviado = false;
                tamObj.exposicao = "";
                tamObj.dataInicio = "";
                tamObj.dataFim = "";
                tamObj.risked = false;
            }
        }
    });

    fecharModalEditarTamanhos();
    atualizarUI();
}

function atualizarUI(){
    salvarLocalStorage();
    atualizarTabelaCasa();
    // Coloque aqui chamadas para atualizar outras tabelas e resumos se desejar
}

carregarLocalStorage();
atualizarUI();
</script>

</body>
</html>
